<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="r">
	
	<!-- 댓글 추가 -->
	<insert id="insert_reply" parameterType="vo.ReplyVO">
		insert into reply values(
		seq_reply_idx.nextval,
		#{r_content},
		sysdate,
		#{b_idx},
		#{m_idx},
		#{r_ip},
		0
		)
	</insert>

	<select id="select_reply_list" resultType="vo.BoardPMemberReplyViewVO" parameterType="java.util.HashMap">
		SELECT rv.*,
		rl.m_idx,
		CASE nvl(rl.m_idx,0) WHEN rl.m_idx THEN 1 ELSE 0 END rl_isliked
		FROM reply_view rv LEFT JOIN (SELECT * FROM REPLY_ISLIKED rl WHERE m_idx=#{m_idx}) rl
		ON rv.r_idx = rl.R_IDX 
		WHERE b_idx=#{b_idx}
		order by rv.r_idx desc
	</select>
	
	<delete id="delete_replys_by_b_idx" parameterType="int">
		delete reply where b_idx=#{b_idx}
	</delete>

</mapper>
